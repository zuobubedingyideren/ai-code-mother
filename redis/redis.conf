# Redis配置文件
# 适用于无密码验证和远程访问的Redis容器

################################## 网络配置 ##################################

# 绑定所有网络接口，允许远程访问
# 默认情况下Redis只监听127.0.0.1，这里改为0.0.0.0允许所有IP访问
bind 0.0.0.0

# Redis监听端口
port 6379

# TCP监听队列长度，在高并发环境下可以防止客户端连接缓慢的问题
tcp-backlog 511

# 客户端空闲超时时间（秒），0表示禁用
timeout 0

# TCP keepalive参数
tcp-keepalive 300

################################## 安全配置 ##################################

# 禁用保护模式，允许无密码访问
# 注意：在生产环境中建议启用密码验证
protected-mode no

# 如果需要密码验证，取消下面这行的注释并设置密码
# requirepass your_password_here

################################## 通用配置 ##################################

# 是否以守护进程方式运行（Docker中通常设为no）
daemonize no

# 进程文件路径
pidfile /var/run/redis_6379.pid

# 日志级别：debug, verbose, notice, warning
loglevel notice

# 日志文件路径，空字符串表示输出到标准输出
logfile ""

# 数据库数量
databases 16

# 是否显示Redis logo
always-show-logo no

# 设置服务器verbosity为'verbose'时是否记录所有查询
set-proc-title yes

# 修改进程标题
proc-title-template "{title} {listen-addr} {server-mode}"

################################## 持久化配置 ##################################

# RDB持久化配置
# save <seconds> <changes>
# 在指定时间内如果至少有指定数量的key发生变化，则保存快照
# 900秒内至少1个key发生变化
save 900 1
# 300秒内至少10个key发生变化  
save 300 10
# 60秒内至少10000个key发生变化
save 60 10000

# 当RDB持久化出现错误后，是否依然进行工作
stop-writes-on-bgsave-error yes

# 使用压缩rdb文件
rdbcompression yes

# RDB文件使用校验和
rdbchecksum yes

# RDB文件名
dbfilename dump.rdb

# 数据目录
dir /data

################################## AOF配置 ##################################

# 是否开启AOF持久化
appendonly no

# AOF文件名
appendfilename "appendonly.aof"

# AOF同步策略：always, everysec, no
appendfsync everysec

# 重写时是否可以运用Appendfsync
no-appendfsync-on-rewrite no

# 设置重写的基准值
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# aof文件可能在尾部是不完整的，当redis启动的时候，aof文件的数据被载入内存
aof-load-truncated yes

# 开启混合持久化
aof-use-rdb-preamble yes

################################## 内存管理 ##################################

# 最大内存限制（字节）
# maxmemory <bytes>

# 内存达到上限时的处理策略
maxmemory-policy allkeys-lru

# LRU算法和最小TTL算法都并非是精确的算法，而是估算值
maxmemory-samples 5

# 是否开启salve的最大内存
replica-ignore-maxmemory yes

################################## 延迟监控 ##################################

# 延迟监控功能是用来监控redis中执行比较缓慢的一些操作
latency-monitor-threshold 0

################################## 事件通知 ##################################

# 键空间通知使得客户端可以通过订阅频道或模式来接收那些以某种方式改动了Redis数据集的事件
notify-keyspace-events ""

################################## 高级配置 ##################################

# 数据量小于等于hash-max-ziplist-entries的用ziplist，大于hash-max-ziplist-entries用hash
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# 数据量小于等于list-max-ziplist-entries的用ziplist，大于list-max-ziplist-entries用list
list-max-ziplist-size -2

# 0-5压缩程度
list-compress-depth 0

# 数据量小于等于set-max-intset-entries用iniset，大于set-max-intset-entries用set
set-max-intset-entries 512

# 数据量小于等于zset-max-ziplist-entries用ziplist，大于zset-max-ziplist-entries用zset
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# value大小小于等于hll-sparse-max-bytes使用稀疏数据结构，大于hll-sparse-max-bytes使用稠密的数据结构
hll-sparse-max-bytes 3000

# Streams单个节点的字节数，以及切换到新节点之前可能包含的最大项目数
stream-node-max-bytes 4096
stream-node-max-entries 100

# Redis将在每100毫秒时使用1毫秒的CPU时间来对redis的hash表进行重新hash，可以降低内存的使用
activerehashing yes

# 对客户端输出缓冲进行限制可以强迫那些不从服务器读取数据的客户端断开连接
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# 客户端查询的频率是100hz
hz 10

# 在aof重写的时候，如果打开了aof-rewrite-incremental-fsync开关，系统会每32MB执行一次fsync
aof-rewrite-incremental-fsync yes

# 在rdb保存的时候，如果打开了rdb-save-incremental-fsync开关，系统会每32MB执行一次fsync
rdb-save-incremental-fsync yes